// Reference: https://containers.dev/implementors/json_reference/
{
  "name": "Swift Package devContainer",
  // "build": {
  //   "dockerFile": "Dockerfile",
  //   "args": {
  //     // Update 'SWIFT_VERSION' to change the Swift version in the container.
  //     "SWIFT_VERSION": "6.2"
  //   }
  // },
  "image": "swift:6.2",
  "features": {
      "ghcr.io/devcontainers/features/common-utils:2": {
          "installZsh": "false",
          "username": "ubuntu",
          "upgradePackages": "false"
      },
      // ensure that git is installed
      "ghcr.io/devcontainers/features/git:1": {
          "version": "os-provided",
          "ppa": "false"
      },
      // enable jemalloc to support package-benchmark
      "ghcr.io/swift-server-community/swift-devcontainer-features/jemalloc:1": { }
  },

  "hostRequirements": {
    // ensure that the container has sufficient memory to build Swift projects
    "memory": "4gb"
  },
  
  // Allows the processes in the container to attach a debugger
  "capAdd": [ "SYS_PTRACE" ],
  "securityOpt": [ "seccomp=unconfined" ],

  // Set `remoteUser` to `root` to connect as root instead. More info: https://aka.ms/vscode-remote/containers/non-root.
  "remoteUser": "ubuntu",

  "mounts": [
    // Use a named volume for the build products for optimal performance (https://code.visualstudio.com/remote/advancedcontainers/improve-performance#_use-a-targeted-named-volume)
    "source=${localWorkspaceFolderBasename}-build,target=${containerWorkspaceFolder}/.build,type=volume"
  ],

  // Use 'forwardPorts' to make a list of ports inside the container available locally.
  // "forwardPorts": [],

  "customizations": {
    // Configure properties specific to VS Code.
    "vscode": {
      // Add the IDs of extensions you want installed when the container is created.
      "extensions": [
        "swiftlang.swift-vscode"
      ],
      // Set *default* container specific settings.json values on container create.
      "settings": {
        "lldb.library": "/usr/lib/liblldb.so",
        "swift.buildArguments": []
      }
    }
  },

  // Report the version of Swift
  "postCreateCommand": "swiftc --version"
}